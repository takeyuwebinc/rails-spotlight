# 003_rswag導入によるAPI仕様書の自動生成

## ステータス

承認済み

## 日付

2025-05-18

## コンテキスト

プロジェクトでは、APIエンドポイントを提供しており、特に `api/link_cards/metadata` APIが実装されています。
このAPIは、URLからメタデータ（タイトル、説明、ドメイン、ファビコン、画像URL）を取得する機能を提供しています。

APIの仕様を明確に文書化し、開発者が簡単に参照できるようにする必要があります。また、テストコードとドキュメントを同期させ、
常に最新の状態を保つことが重要です。

テスト標準として、「APIについて、rswag gem を使って spec から OpenAPI 3.0 Specification を作成する」ことが定められています。

## 決定

rswag gemを導入し、RSpecテストから自動的にOpenAPI 3.0仕様書を生成することを決定しました。
具体的には以下の実装を行います：

1. rswag-api, rswag-ui, rswag-specs gemを導入
2. Swagger UI を `/api-docs` エンドポイントで提供
3. 既存のRSpecテストをベースにしたSwagger仕様ファイルを作成
4. OpenAPI 3.0仕様書を自動生成

## 結果

この決定により、以下の効果が期待されます：

### ポジティブな影響
- APIドキュメントが常に最新の状態に保たれる
- 開発者がSwagger UIを通じてAPIを対話的にテストできる
- テストとドキュメントが一元管理される
- APIの使用方法が明確に理解できるようになる
- フロントエンド開発者とバックエンド開発者のコミュニケーションが改善される

### ネガティブな影響
- テストコードに追加の記述が必要になる
- 新しいAPIを追加する際の開発工数が若干増加する

## 代替案

以下の代替案が検討されましたが、採用されませんでした：

1. **手動でのAPIドキュメント作成**
   - メリット: 実装が簡単
   - デメリット: ドキュメントとコードの同期が取れなくなるリスクが高い
   - 不採用理由: 長期的なメンテナンスコストが高い

2. **Postman Collection の作成**
   - メリット: Postmanユーザーにとって使いやすい
   - デメリット: テストコードとの統合が難しい
   - 不採用理由: テストとドキュメントの一元管理ができない

3. **他のAPI文書化ツール（例：API Blueprint, RAML）**
   - メリット: 様々な機能や表現力がある
   - デメリット: Railsとの統合が比較的複雑
   - 不採用理由: RSpecテストとの統合が容易なrswagの方が適している

## 参考資料

- [rswag GitHub リポジトリ](https://github.com/rswag/rswag)
- [OpenAPI 3.0 仕様](https://spec.openapis.org/oas/v3.0.3)
- [Swagger UI](https://swagger.io/tools/swagger-ui/)
