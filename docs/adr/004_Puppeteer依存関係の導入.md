# 004_Puppeteer依存関係の導入

## ステータス

承認済み

## 日付

2025-05-18

## コンテキスト

開発環境では、ブラウザ自動化ツールであるPuppeteerを使用して、ウェブページの表示確認やインタラクティブなテストを行う必要があります。特にCLINEツールのブラウザアクション機能を使用する際に、Puppeteerが内部的に使用するChromiumブラウザが正常に動作するためには、特定のシステムライブラリが必要です。

現在の開発コンテナ環境では、これらの依存関係が不足しているため、ブラウザアクション機能を使用しようとすると以下のようなエラーが発生します：

```
Error executing browser action: Failed to launch the browser process!
/path/to/chrome: error while loading shared libraries: libatk-1.0.so.0: cannot open shared object file: No such file or directory
```

このエラーを解決し、開発環境でブラウザアクション機能を正常に使用できるようにする必要があります。

## 決定

Puppeteer/Chromiumの依存関係を開発環境に導入することを決定しました。具体的には以下の実装を行います：

1. Puppeteer/Chromium依存関係をインストールするスクリプト `bin/install-puppeteer-deps.sh` を作成
2. 開発コンテナのDockerfileに依存関係のインストール手順を追加
3. Claude Code設定スクリプト `bin/claude-setup.sh` を更新して、依存関係インストールスクリプトを実行するように変更

これにより、開発環境構築時に必要な依存関係が自動的にインストールされ、ブラウザアクション機能が正常に動作するようになります。

## 結果

この決定により、以下の効果が期待されます：

### ポジティブな影響
- ブラウザアクション機能が正常に動作するようになり、ウェブページの表示確認やインタラクティブなテストが可能になる
- 新しい開発環境のセットアップ時に、依存関係の不足によるエラーが発生しなくなる
- 開発者がブラウザ自動化機能を活用した開発やテストを行いやすくなる
- CLINEツールの全機能を活用できるようになる

### ネガティブな影響
- 開発コンテナのイメージサイズが若干増加する
- 環境構築時間が若干増加する

## 代替案

以下の代替案が検討されましたが、採用されませんでした：

1. **手動での依存関係インストール**
   - メリット: 必要な時だけインストールできる
   - デメリット: 開発者ごとに手動でインストールする必要がある
   - 不採用理由: 開発環境の一貫性が保てず、セットアップの手間が増える

2. **別のブラウザ自動化ツールの使用**
   - メリット: 依存関係が少ない可能性がある
   - デメリット: CLINEツールとの互換性がない
   - 不採用理由: CLINEツールはPuppeteerを使用しているため、代替ツールでは機能しない

3. **ヘッドレスモードのみの使用**
   - メリット: 一部の依存関係が不要になる可能性がある
   - デメリット: 視覚的な確認ができない
   - 不採用理由: 視覚的な確認が必要なケースが多いため、制限が大きい

## 参考資料

- [Puppeteer公式ドキュメント](https://pptr.dev/)
- [Puppeteerのトラブルシューティングガイド](https://pptr.dev/troubleshooting)
- [Chromium依存関係に関するドキュメント](https://github.com/puppeteer/puppeteer/blob/main/docs/troubleshooting.md#chrome-headless-doesnt-launch-on-unix)
