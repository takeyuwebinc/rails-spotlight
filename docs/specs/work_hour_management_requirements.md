# 工数管理機能 要件定義書

## 1. 機能概要

クライアント向けの作業報告・請求根拠として工数実績を記録し、Webサイト上の「今後3カ月の稼働予定」に稼働率を動的に表示する機能。

### 主要な提供価値

- クライアントへの作業報告書（CSV）の出力
- 案件ごとの工数実績の記録・管理
- Webサイトでの稼働率の動的表示（現在のハードコーディングを置き換え）
- freee工数管理からの移行

### 想定データ規模

- アクティブな案件数：月5件程度
- 工数レコード：月50件程度

## 2. 機能要件

### 2.1 クライアントマスタ管理

#### クライアントの登録・更新・削除

クライアント（発注元）の基本情報を管理する。

**管理項目**:
- クライアントコード（一意識別子）
- クライアント名（例：`ABC商事`）

### 2.2 案件マスタ管理

#### 案件の登録・更新・削除

案件（プロジェクト）の基本情報を管理する。

**管理項目**:
- プロジェクトコード（一意識別子、例：`abc-system`）
- プロジェクト名（例：`ABC基幹システム`）
- クライアント（クライアントマスタから選択）
- カラー（表示用、例：`#fa6414`）
- 期間（開始日〜終了日）
- 運用ステータス（運用中/終了）

#### 月別見込み工数の登録

案件ごとに月別の見込み工数（時間）を登録する。

- 対象月（年月）
- 見込み工数（時間単位）

### 2.3 工数実績管理

#### 工数の登録・更新・削除

日々の作業実績を記録する。

**記録項目**:
- 対象月
- 工数登録日（作業日）
- 案件（案件マスタから選択、または「その他」）
- 業務内容（作業の説明）
- 工数実績（分単位）

**「その他」の扱い**:
- 案件に紐づかない作業時間を記録可能
- プロジェクトコード、クライアント名は空欄

### 2.4 稼働率表示

#### 計算方法

```
月間稼働率(%) = (各案件の月別見込み工数の合計 ÷ 160時間) × 100
```

- 基準稼働時間：月160時間（固定）
- 表示対象：今後3カ月分
- 100%を超える場合は100%として表示

#### 表示形式

現在のWebサイトの表示形式を維持:
- 年月表示（例：2025年7月）
- パーセント表示（例：100%）
- プログレスバーによる視覚化

### 2.5 CSVエクスポート

#### 工数実績のエクスポート

指定期間の工数実績をCSV形式で出力する。

**出力形式**:
```csv
対象月,工数登録日,プロジェクト,プロジェクトコード,業務内容,工数実績(分)
```

**フィルタ条件**:
- 対象期間（開始月〜終了月）
- 案件（任意、全件または特定案件）

### 2.6 CSVインポート

#### 案件マスタのインポート

freee工数管理からエクスポートしたCSVを取り込む。

**入力形式（freee形式）**:
```csv
システムID,プロジェクトコード,プロジェクト名,プロジェクト概要,プロジェクトマネージャー,カラー,期間from,期間to,従業員への公開設定,運用ステータス,受注ステータス,原価分類,プロジェクトメンバー,発注元,発注先,事業部,案件種別,招待URL
```

**マッピング**:
| freee項目 | 本機能の項目 |
|-----------|-------------|
| プロジェクトコード | プロジェクトコード |
| プロジェクト名 | プロジェクト名 |
| カラー | カラー |
| 期間from | 開始日 |
| 期間to | 終了日 |
| 運用ステータス | 運用ステータス |
| 発注元 | クライアント（クライアントマスタを自動生成） |

**クライアントの自動生成**:
- 「発注元」の値でクライアントマスタを検索
- 存在しない場合は新規作成（クライアントコードは発注元を元に自動生成）
- 上記以外の項目は無視する
- 既存のプロジェクトコードと重複する場合は更新（上書き）

#### 工数実績のインポート

freee工数管理からエクスポートしたCSVを取り込む。

**入力形式（freee形式）**:
```csv
対象従業員,対象月,工数登録日,プロジェクト,プロジェクトコード,業務内容,工数実績(分),実績単価名,実績単価,人件費,原価分類,顧客案件用作業種別,社内業務用作業種別,運用保守,事業部,案件種別
```

**マッピング**:
| freee項目 | 本機能の項目 |
|-----------|-------------|
| 対象月 | 対象月 |
| 工数登録日 | 工数登録日 |
| プロジェクト | プロジェクト名 |
| プロジェクトコード | プロジェクトコード |
| 業務内容 | 業務内容 |
| 工数実績(分) | 工数実績 |

- 上記以外の項目は無視する
- プロジェクトコードが案件マスタに存在しない場合、プロジェクト名のみで登録
- 「その他」の場合はプロジェクトコードなしで登録

### 2.7 管理画面

#### アクセス制御

- Basic認証によるアクセス制限
- 管理者（自分）のみがアクセス可能

#### 画面構成

1. **クライアント一覧画面**
   - クライアントの一覧表示
   - 新規登録、編集、削除

2. **案件一覧画面**
   - 案件の一覧表示
   - 新規登録、編集、削除

3. **案件詳細/編集画面**
   - 案件の基本情報の入力
   - 月別見込み工数の登録

4. **工数カレンダー画面**
   - 週/月表示の切り替え
   - 案件ごとの色分け表示
   - 日ごとの合計時間表示
   - 工数の登録・編集・削除

5. **CSVインポート画面**
   - 案件マスタCSVのアップロード
   - 工数実績CSVのアップロード
   - インポート結果の表示

6. **CSVエクスポート画面**
   - 期間の指定
   - 案件のフィルタ（任意）
   - ダウンロード実行

## 3. 前提条件・制約事項

### 3.1 前提条件

- ユーザーは1名のみ（自分）
- 月間の基準稼働時間は160時間で固定
- freee工数管理から完全移行する

### 3.2 制約事項

- 複数ユーザーには対応しない
- 請求書生成機能は含まない
- 外部サービス（freee等）とのAPI連携は行わない

### 3.3 依存関係

- 既存の「お仕事の募集状況表示機能」を置き換える
  - 参照：[docs/specs/availability_status_feature.md](availability_status_feature.md)

## 4. 用語定義

| 用語 | 説明 |
|------|------|
| クライアント | 発注元の企業・組織 |
| 案件 | クライアントから受注したプロジェクト単位 |
| 工数 | 作業に費やした時間（分単位で記録） |
| 見込み工数 | 案件ごとに月単位で設定する予定稼働時間 |
| 稼働率 | 月間の見込み工数合計÷160時間×100（%） |
| 対象月 | 工数を計上する月（作業日の属する月） |

## 5. 受け入れ条件

### クライアントマスタ管理

- [ ] クライアントの登録・更新・削除ができること

### 案件マスタ管理

- [ ] 案件の登録・更新・削除ができること
- [ ] 案件にクライアントを紐づけられること
- [ ] 案件に月別の見込み工数を設定できること
- [ ] freee形式のCSVから案件をインポートできること
- [ ] インポート時に発注元からクライアントが自動生成されること

### 工数実績管理

- [ ] 工数の登録・更新・削除ができること
- [ ] カレンダー形式で工数を確認できること
- [ ] 案件ごとに色分け表示されること
- [ ] 「その他」として案件なしの工数を登録できること
- [ ] freee形式のCSVから工数実績をインポートできること

### 稼働率表示

- [ ] Webサイトのトップページに今後3カ月の稼働率が表示されること
- [ ] 稼働率が見込み工数から自動計算されること
- [ ] 現在のハードコーディングされた表示を置き換えること

### CSVエクスポート

- [ ] 指定期間の工数実績をCSVでダウンロードできること
- [ ] 出力形式が指定のフォーマットに従っていること

### アクセス制御

- [ ] 管理画面がBasic認証で保護されていること

## 6. 今後の拡張予定

### ファーストリリース（今回対象）

- クライアントマスタ管理（CRUD）
- 案件マスタ管理（CRUD、月別見込み工数）
- 工数実績管理（CRUD、カレンダー表示）
- 稼働率の動的表示
- CSVインポート/エクスポート
- Basic認証による管理画面保護

### セカンドリリース以降

- MCPツールによる工数登録・更新
  - 案件マスタの操作
  - 月別見込み工数の登録
  - 工数実績の登録・更新
- レポート機能（月次サマリー等）
- 案件別の収支管理
